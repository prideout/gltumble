!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.Trackball=i()}(this,function(){"use strict";var t=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array;Math.PI;function n(){var t=new i(16);return i!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function e(i,n,e){var r,s,a,o=e[0],h=e[1],c=e[2],u=Math.sqrt(o*o+h*h+c*c);return u<t?null:(o*=u=1/u,h*=u,c*=u,r=Math.sin(n),a=1-(s=Math.cos(n)),i[0]=o*o*a+s,i[1]=h*o*a+c*r,i[2]=c*o*a-h*r,i[3]=0,i[4]=o*h*a-c*r,i[5]=h*h*a+s,i[6]=c*h*a+o*r,i[7]=0,i[8]=o*c*a+h*r,i[9]=h*c*a-o*r,i[10]=c*c*a+s,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}function r(){var t=new i(3);return i!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function s(t,n,e){var r=new i(3);return r[0]=t,r[1]=n,r[2]=e,r}function a(t,i,n){var e=i[0],r=i[1],s=i[2],a=n[0],o=n[1],h=n[2];return t[0]=r*h-s*o,t[1]=s*a-e*h,t[2]=e*o-r*a,t}var o,h=function(t){var i=t[0],n=t[1],e=t[2];return Math.sqrt(i*i+n*n+e*e)};o=r();!function(){var t,n=(t=new i(4),i!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function c(){var t=new i(4);return i!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function u(i,n,e,r){var s=n[0],a=n[1],o=n[2],h=n[3],c=e[0],u=e[1],g=e[2],p=e[3],l=void 0,f=void 0,v=void 0,d=void 0,P=void 0;return(f=s*c+a*u+o*g+h*p)<0&&(f=-f,c=-c,u=-u,g=-g,p=-p),1-f>t?(l=Math.acos(f),v=Math.sin(l),d=Math.sin((1-r)*l)/v,P=Math.sin(r*l)/v):(d=1-r,P=r),i[0]=d*s+P*c,i[1]=d*a+P*u,i[2]=d*o+P*g,i[3]=d*h+P*p,i}var g,p,l,f,v,d,P,S=function(t,i){var n=i[0],e=i[1],r=i[2],s=i[3],a=n*n+e*e+r*r+s*s;return a>0&&(a=1/Math.sqrt(a),t[0]=n*a,t[1]=e*a,t[2]=r*a,t[3]=s*a),t};g=r(),p=s(1,0,0),l=s(0,1,0),f=c(),v=c(),d=new i(9),i!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[5]=0,d[6]=0,d[7]=0),d[0]=1,d[4]=1,d[8]=1,P=d;function y(){var t=new i(2);return i!=Float32Array&&(t[0]=0,t[1]=0),t}!function(){var t=y()}();var b=Object.freeze({homeTilt:.25,startSpin:.02,autoTick:!0,friction:.125}),M=Object.freeze({Resting:0,Coasting:1,DraggingInit:2,DraggingSpin:3,DraggingTilt:4}),m=Object.freeze({allowTilt:!0,allowSpin:!0,epsilon:3,radiansPerPixel:[.01,.01]}),T=function(t,i){if(this.config={},Object.assign(this.config,m),Object.assign(this.config,b),Object.assign(this.config,i),this.config=Object.freeze(this.config),this.config.autoTick&&(this.tick=this.tick.bind(this),window.requestAnimationFrame(this.tick)),t){var n=this.handleEvent.bind(this);t.addEventListener("wheel",n),t.addEventListener("pointermove",n),t.addEventListener("pointerdown",n),t.addEventListener("pointerup",n)}this.startPosition=[0,0],this.currentPosition=[0,0],this.previousPosition=this.currentPosition.slice(),this.previous2Position=this.currentPosition.slice(),this.currentSpin=0,this.currentTilt=this.config.homeTilt,this.currentState=this.config.startSpin?M.Coasting:M.Resting,this.previousTime=null,this.inertiaSpeed=[this.config.startSpin,0],this.initialInertia=.125,Object.seal(this)};return T.prototype.handleEvent=function(t){if("touch"!==t.pointerType||t.isPrimary){var i=[t.clientX,t.clientY];"pointerdown"===t.type&&this.startDrag(i),"pointerup"===t.type&&this.endDrag(i),"pointermove"===t.type&&t.buttons&&this.updateDrag(i)}},T.prototype.tick=function(){this.config.autoTick&&window.requestAnimationFrame(this.tick);var i=Date.now(),n=this.currentState;null==this.previousTime&&(this.previousTime=i);var e=i-this.previousTime;this.previousTime=i;var r,s,a,o,h,c,u=n===M.DraggingSpin||n===M.DraggingInit;n===M.Coasting?(this.currentSpin+=this.inertiaSpeed[0]*e,Math.abs(this.inertiaSpeed[0])<1e-4&&Math.abs(this.inertiaSpeed[1])<1e-4&&(this.currentState=M.Resting)):u&&(r=this.currentPosition,s=this.previous2Position,a=r[0],o=r[1],h=s[0],c=s[1],Math.abs(a-h)<=t*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-c)<=t*Math.max(1,Math.abs(o),Math.abs(c)))&&(this.currentSpin+=this.inertiaSpeed[0]*e),this.inertiaSpeed[0]*=1-this.config.friction,this.inertiaSpeed[1]*=1-this.config.friction,this.previous2Position=this.previousPosition.slice(),this.previousPosition=this.currentPosition.slice()},T.prototype.startDrag=function(t){this.startPosition=t.slice(),this.currentPosition=t.slice(),this.currentState=M.DraggingInit},T.prototype.endDrag=function(t){var i;this.currentPosition=t.slice(),i=this.getAngles(),this.currentSpin=i[0],this.currentTilt=i[1],1===this.config.friction?this.currentState=M.Resting:this.currentState=M.Coasting},T.prototype.updateDrag=function(t){var i=this.getAngles(),n=i[0],e=i[1];this.currentPosition=t.slice();var r=this.getAngles(),s=r[0],a=r[1];this.inertiaSpeed[0]=this.initialInertia*(s-n),this.inertiaSpeed[1]=this.initialInertia*(a-e)},T.prototype.getAngles=function(){var t,i,n,e=(t=y(),i=this.currentPosition,n=this.startPosition,t[0]=i[0]-n[0],t[1]=i[1]-n[1],t),r=this.config,s=this.currentSpin,a=this.currentTilt;return this.currentState===M.DraggingSpin?s+=r.radiansPerPixel[0]*e[0]:this.currentState===M.DraggingTilt?a+=r.radiansPerPixel[1]*e[1]:this.currentState===M.DraggingInit&&(s+=r.radiansPerPixel[0]*e[0],a+=r.radiansPerPixel[1]*e[1]),[s,a]},T.prototype.getMatrix=function(){var t,i,r,s,a,o,h,c,u,g,p,l,f,v,d,P,S,y,b,M,m,T,w,A=this.getAngles(),D=e(n(),A[0],[0,1,0]),x=e(n(),A[1],[1,0,0]);return t=x,r=D,s=(i=x)[0],a=i[1],o=i[2],h=i[3],c=i[4],u=i[5],g=i[6],p=i[7],l=i[8],f=i[9],v=i[10],d=i[11],P=i[12],S=i[13],y=i[14],b=i[15],M=r[0],m=r[1],T=r[2],w=r[3],t[0]=M*s+m*c+T*l+w*P,t[1]=M*a+m*u+T*f+w*S,t[2]=M*o+m*g+T*v+w*y,t[3]=M*h+m*p+T*d+w*b,M=r[4],m=r[5],T=r[6],w=r[7],t[4]=M*s+m*c+T*l+w*P,t[5]=M*a+m*u+T*f+w*S,t[6]=M*o+m*g+T*v+w*y,t[7]=M*h+m*p+T*d+w*b,M=r[8],m=r[9],T=r[10],w=r[11],t[8]=M*s+m*c+T*l+w*P,t[9]=M*a+m*u+T*f+w*S,t[10]=M*o+m*g+T*v+w*y,t[11]=M*h+m*p+T*d+w*b,M=r[12],m=r[13],T=r[14],w=r[15],t[12]=M*s+m*c+T*l+w*P,t[13]=M*a+m*u+T*f+w*S,t[14]=M*o+m*g+T*v+w*y,t[15]=M*h+m*p+T*d+w*b,t},T});
